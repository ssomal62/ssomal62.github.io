---
layout : post
title : "SimpleBoard #2"
date: 2023-11-15
summary: 
categories : [ spring ]
tags : [ bitcamp,  naverCloudCamp ]
---


### ì½”ë“œ ì‘ì„± ìˆœì„œ

* í˜¸ì¶œë˜ëŠ” ì—­ë°©í–¥ìœ¼ë¡œ ì½”ë“œ ì‘ì„±

> 1. Mapper - 2. DAO - 3. Controller - 4. jsp

* ê¸€ì“°ê¸°ì™€ ë¦¬ìŠ¤íŠ¸

### ê¸€ì“°ê¸° - INSERT

#### 1. BoardMapper.xml `insert` ì¶”ê°€

```xml
<insert id = "insertBoard" parameterType="BoardDto">
    <!--ì•Œì•„ì„œ BoardDtoë‚´ì—ì„œ ë¶ˆëŸ¬ì˜´-->
    INSERT INTO simpleboard VALUES (null, #{writer}, #{subject},#{content}, #{photo}, 0, now())
</insert>
```

#### 2. BoardDao `insertBoard` ì¶”ê°€ 

```java
//ì¶”ê°€ ëœ ë¶€ë¶„

public  void insertBoard(BoardDto dto) {
    //nameSpaceëŠ” ì„¤ì •íŒŒì¼ì—ì„œ ì„¤ì •í•œ namespaceì´ë¦„
    session.insert(nameSpace + "insertBoard", dto); //BoardMapperì˜ insert idê°’
}
```

#### 3. BoardWriteController

```java
@Controller
@RequestMapping("/simple") //ê³µí†µëœ ê²½ë¡œë¥¼ ì§€ì •, ì—¬ê¸° ë‚´ë¶€ ì½”ë“œë“¤ì€ /simple í•˜ìœ„ ê²½ë¡œë¡œ ë“¤ì–´ê°€ê²Œ ë¨.
@AllArgsConstructor  //ì œë°œ ë¹¼ë¨¹ì§€ë§ì.. ã… ã… 
public class BoardWriteController {

    private BoardDao boardDao;

    @GetMapping("/writeform")
    public String form(){
        return "writeform";
    }
    
    @PostMapping("/addprocess")
    public String add(HttpServletRequest request, @ModelAttribute BoardDto dto, @RequestParam MultipartFile upload){
        String path = request.getSession().getServletContext().getRealPath("/WEB-INF/upload");

        System.out.println(path);  //ê²½ë¡œ í™•ì¸ìš©
        String photo = UUID.randomUUID().toString();

        //íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šì„ ë•Œ ì²˜ë¦¬
        if(upload.getOriginalFilename().equals("")){
            dto.setPhoto("no");
        }else{
            dto.setPhoto(photo);
        }
        
        //íŒŒì¼ ì—…ë¡œë“œ
        try {
            upload.transferTo(new File(path + "/" + photo));
        }catch (IllegalStateException e){
            e.getStackTrace();
        } catch (IOException e){
            e.getStackTrace();
        }

        //db insert
        boardDao.insertBoard(dto);
        return "redirect:./list";
    }
}
```


#### 4. writefrom.jsp

```html
<img id="showimg"
     style="position: absolute;left:600px;top:60px;max-width: 300px;">

<div style="margin:30px 50px;">
  
  <!--* action : ê²½ë¡œì„¤ì •í•´ì£¼ê¸°-->
    <form action="./addprocess" method="post" enctype="multipart/form-data">
        <table class="table table-bordered" style="width:500px;">
            <caption align="top">ê¸€ì“°ê¸°</caption>
            <tr>
                <th width="100">ì‘ì„±ì</th>
                <td>
                                     <!-- writer -->
                    <input type="text" name="writer" class="form-control"
                           style="width: 150px" autofocus="autofocus" required="required">
                </td>
            </tr>
            <tr>
                <th width="100">ì œëª©</th>
                <td class="input-group">
                                       <!-- subject -->
                    <input type="text" name="subject" class="form-control"
                           required="required">
                                  <!-- upload (photo ì²˜ë¦¬) -->
                    <input type="file" name="upload" id="upload"
                           style="display: none;">
                    &nbsp;&nbsp;
                    <i class="bi bi-camera-fill uploadcamera"></i>
                </td>
            </tr>
            <tr>
                <th width="100">ë‚´ìš©</th>
                <td>
					<textarea style="width: 100%;height: 150px;"
                              name="content" required="required" class="form-control"></textarea>
                               <!--  (ìœ„) content -->
                </td>
            </tr>
            <tr>
                <td colspan="2" align="center">
                    <button type="submit" class="btn btn-outline-success"
                            style="width: 100px;">ë“±ë¡</button>

                    <button type="button" class="btn btn-outline-success"
                            style="width: 100px;" onclick="history.back()">ì´ì „</button>
                </td>
            </tr>
        </table>
    </form>
</div>
```


### ë¦¬ìŠ¤íŠ¸ - SELECT ALL BOARD

#### 1. BoardMapper.xml `selectAllBoard` ì¶”ê°€


```xml
<select id="selectAllBoard" resultType="BoardDto">
    SELECT * FROM simpleboard ORDER BY num DESC
</select>
```

#### 2. BoardDao `selectAllBoard` ì¶”ê°€ 

```javapublic List<BoardDto> getAllDatas(){
    return session.selectList(nameSpace + "selectAllBoard");
}
```

#### 3. BoardListController

```java
    @GetMapping("/simple/list")
    public String list(Model model) {

        int totalCount = boardDao.getTotalCount();
        model.addAttribute("totalCount", totalCount);
         
        //ì¶”ê°€
        List<BoardDto> list = boardDao.getAllDatas();
        model.addAttribute("list", list);
        
        return "list";
    }
```

#### 4. list.jsp

```html
<div style="margin: 30px">
  <h3 class = "alert alert-danger">ì´ ${totalCount}ê°œì˜ ê¸€ì´ ìˆìŠµë‹ˆë‹¤.
    <button type="button" class = "btn btn-outline-sucess" onclick="location.href='./writeform'" style="float: right"> ê¸€ì“°ê¸°</button>
  </h3>
  <table class = table table-striped style="margin: 30px; width: 600px;">
    <thead>
    <tr>
      <th width = "50">ë²ˆí˜¸</th>
      <th width = "300">ì œëª©</th>
      <th width = "80">ì‘ì„±ì</th>
      <th width = "100">ì‘ì„±ì¼</th>
      <th width = "50">ì¡°íšŒ</th>
    </tr>
    </thead>
    <tbody>
    <c:forEach var="dto" items="${list}" varStatus="n">
      <tr>
        <td>${totalCount - n.index}</td>
        <td> <a href ="./content?num=${dto.num}" style="color:black; text-decoration: none;">
          ${dto.subject}
          <c:if test = "${dto.photo != 'no'}">
            <!--photoê°’ì´ noê°€ ì•„ë‹ˆë©´ ì•„ì´ì½˜ ì¶œë ¥-->
            ğŸŠ
          </c:if>
        </a>
        </td>

        <td>${dto.writer}</td>
        <td>
          <fmt:formatDate value="${dto.writeday}" pattern="yyyy.MM.dd"/>
        </td>
        <td>
          ${dto.readcount}
        </td>
      </tr>
    </c:forEach>
    </tbody>
  </table>
</div>
```

ì´ì œ Contentë¥¼ í˜ì´ì§€ê°€ ë‚˜ì˜¤ë„ë¡ ì„¤ì •í•´ì£¼ë©´ëœë‹¤.

### Content

#### 1. BoardMapper.xml - Readcount(ì¡°íšŒìˆ˜) & í•˜ë‚˜ì˜ ë°ì´í„° ì¡°íšŒ

```xml
<!--ì¡°íšŒìˆ˜-->
<update id = "updateReadcount" parameterType="int">
    UPDATE simpleboard SET readcount = (readcount + 1) WHERE num = #{num}
</update>

<!--í•˜ë‚˜ì˜ ë°ì´í„° ì¡°íšŒ-->
<select id = "selectOneData" parameterType="int" resultType="BoardDto">
SELECT * FROM simpleboard WHERE num = #{num}
</select>
```

#### 2. BoardDao 

```java
//ì¡°íšŒìˆ˜
public void updateReadCount(int num){
    session.update(nameSpace + "updateReadCount", num);
}
//í•˜ë‚˜ì˜ ë°ì´í„° ì¡°íšŒ
public BoardDto getData(int nsum){
  return  session.selectOne(nameSpace + "selectOneData",num);
}
```

#### 3. BoardContentController

```java
@Controller
@AllArgsConstructor
public class BoardContentController {

    private BoardDao boardDao;

    @GetMapping("/simple/content")
    public String content(Model model, @RequestParam int num) {

        //ì¡°íšŒìˆ˜ ì¦ê°€ ì‹œí‚¤ê¸°
        boardDao.updateReadCount(num);

        //dto ì–»ê¸°
        BoardDto dto = boardDao.getData(num);

        //model ì €ì¥
        model.addAttribute("dto",dto);

        return "content";
    }
}
```

#### 4. content.jsp

```html
<div style="margin: 30px; width:500px;">
    <h3><b>${dto.subject}</b></h3>
    <div style="width: 500px">
        <span>${dto.writer}</span>
        <span class = "day" style="margin-right: 20px">
            ì¡°íšŒ ${dto.readcount}
            <fmt:formatDate value="${dto.writeday}" pattern="yyyy-MM-dd HH:mm"/>
        </span>
        <hr>
        <pre>${dto.content}</pre>
        <c:if test = "${dto.photo != 'no'}">
            <br><br>
            <img src = "../upload/${dto.photo}" width="300px">
        </c:if>

        <br><br>
        <button type="button" class="btn btn-outline-info btn-sm" style="width: 80px" onclick="location.href='./writeform'">ê¸€ì“°ê¸°</button>
        <button type="button" class="btn btn-outline-info btn-sm" style="width: 80px" onclick="location.href='./list'">ëª©ë¡</button>
        <button type="button" class="btn btn-outline-info btn-sm" style="width: 80px" onclick="location.href='./updateform?num=${dto.num}'">ìˆ˜ì •</button>
        <button type="button" class="btn btn-outline-info btn-sm" style="width: 80px" onclick="location.href='./delete?num=${dto.num}'">ì‚­ì œ</button>
    </div>
</div>
```

### DELETE

#### 1. BoardMapper.xml

```xml
<delete id="deleteBoard" parameterType="int">
    DELETE FROM simpleboard WHERE num = #{num}
</delete>
```

#### 2. BoardDao 

```java
public void deleteData(int num){
    session.delete(nameSpace + "deleteBoard",num);
}
```


#### 3. BoardContentController

```java
@GetMapping("/simple/delete")
public String delete(@RequestParam int num){
    boardDao.deleteData(num);
    return "redirect:./list";
}
```


#### 4. content.jsp

```html
 <button type="button" class="btn btn-outline-info btn-sm" style="width: 80px" onclick="location.href='./delete?num=${dto.num}'">ì‚­ì œ</button>
```


### UPDATE í¼ 

#### 1. BoardContentController

```java
@GetMapping("/simple/update")
public String update(@RequestParam int num, Model model){

    //numì— í•´ë‹¹í•˜ëŠ” dtoë¥¼ ì–»ì–´ì„œ
    BoardDto dto = boardDao.getData(num);

    //dtoë¥¼ ëª¨ë¸ì— ì €ì¥
    model.addAttribute("dto",dto);

    return "updateform";
}
```

#### 2. updateform.jsp

writeform ë³µì‚¬ í›„ ìˆ˜ì •

```html
<img id="showimg"
  style="position: absolute;left:600px;top:60px;max-width: 300px;"
  src = "../upload/${dto.photo}" onerror="this.style.display='none">
            <!--â¬†ì‚¬ì§„ ê°€ì ¸ì˜¤ê¸°-->              <!--â¬†ì‚¬ì§„ ì—ëŸ¬ì¼ê²½ìš° ìˆ¨ê¹€ì²˜ë¦¬-->
...

<form action="./updateprocess" method="post" enctype="multipart/form-data">
  ...
<input type="hidden" name = "num" value="${dto.num}">
...
<input type="text" name="writer" class="form-control"
       style="width: 150px" autofocus="autofocus" required="required" value = "${dto.writer}">

...

<input type="text" name="subject" class="form-control"
       required="required" vlaue = "${dto.subject}">
...
  <textarea style="width: 100%;height: 150px;"
            name="content" required="required" class="form-control" >${dto.content}</textarea>
```







### MyBatis ifë¬¸ 


#### ifë¬¸ ì˜ˆì‹œ

```xml
<selectid=â€findActiveBlogLikeâ€
parameterType=â€Blogâ€resultType=â€Blogâ€>
  
  SELECT * FROM BLOG
  WHERE

  <if test=â€state != nullâ€>
    state = #{state}
  </if>

  <if test=â€title != nullâ€>
    AND title like #{title}
  </if>

  <if test=â€author != null and author.name!= nullâ€>
    AND title like #{author.name}
  </if>

</select>
```


### UPDATE ì ìš© (MyBatis ifë¬¸ í™œìš©)

#### 1. BoardMapper.xml

```xml
<update id="updateBoard" parameterType="BoardDto">
    UPDATE simpleboard SET writer = #{writer}, subject = #{subject}, content = #{content}

    <if test = "photo != null">
        , photo = #{photo}
    </if>
  
    WHERE num = #{num}
</update>
```

#### 2. BoardDao

```java
public void updateData(BoardDto dto){
    session.update(nameSpace + "updateBoard",dto);  
}
```

#### 3. BoardContentController

```java
@PostMapping("/simple/updateprocess")
  public String update(@ModelAttribute BoardDto dto,
                       @RequestParam MultipartFile upload,
                       HttpServletRequest request){

      String path = request.getSession().getServletContext().getRealPath("/WEB-INF/upload");
      String photo = "";

      if (upload.getOriginalFilename().equals("")){
          dto.setPhoto(null); //BoardMapperì˜ ifë¬¸ì—ì„œ photo!=null ì´ë¼ëŠ” ì¡°ê±´ì„ ë§ì¶”ê¸° ìœ„í•¨
      }else{
          photo = UUID.randomUUID().toString();
          dto.setPhoto(photo);
      }

      //ì—…ë¡œë“œ

      try {
          upload.transferTo(new File(path + "/" + photo));
      } catch (IllegalStateException e) {
          e.getStackTrace();
      }catch (IOException e) {
          e.getStackTrace();
      }

      //dbìˆ˜ì •
      boardDao.updateData(dto);
      
      return "redirect:./content?num=" + dto.getNum();
  }
```

#### 4. content.jsp

```html
<button type="button" class="btn btn-outline-info btn-sm" style="width: 80px" onclick="location.href='./updateform?num=${dto.num}'">ìˆ˜ì •</button>
```

