---
layout : post
title : "Memo #1"
date: 2023-11-16
summary: 
categories : [ spring ]
tags : [ bitcamp,  naverCloudCamp ]
---


---
layout : single
title : "Spring â”‚ MEMO #1"
categories : spring
tag : [spring,ë„¤ì´ë²„í´ë¼ìš°ë“œìº í”„]
toc: true
toc_sticky: true
breadcrumb: true
---


### DB í…Œì´ë¸” ìƒì„±

```mysql
CREATE TABLE memodb(
    num SMALLINT AUTO_INCREMENT PRIMARY KEY,
    nickname VARCHAR(30),
    photo VARCHAR(100),
    memo VARCHAR(1000),
    likes SMALLINT DEFAULT 0,
    writeday DATETIME
)
```

![img_12.png](./img/009/img_12.png)

### íŒŒì¼íŠ¸ë¦¬

![img_13.png](./img/009/img_13.png)




### JSON í…ŒìŠ¤íŠ¸1

```java
@Controller
public class RestTestController {

    @GetMapping("/test/list1")
    @ResponseBody  public List<MemoDto2> list1(){
    //ìœ„ ì–´ë…¸í…Œì´ì…˜ ë¹¼ë¨¹ì§€ ë§ì !
        List<MemoDto2> list = new ArrayList<>();
        list.add(new MemoDto2(1, "ê¹€ë‚˜ë‚˜", "1.jpg", "ì•ˆë…•í•˜ì„¸ìš”", 5, "2023-10-10"));
        list.add(new MemoDto2(1, "ìº”ë””ë°”", "2.jpg", "íˆíˆ", 2, "2023-10-13"));
        list.add(new MemoDto2(1, "ë¹„ë¹„ë¹…", "3.jpg", "íêµ¬", 7, "2023-11-22"));

        return list;
    }
}
```

* ê²°ê³¼

![img_15.png](./img/009/img_15.png)



#### postmanì„ ì´ìš©í•´ì„œ JSON ë°ì´í„° ë³´ê¸°

![img_14.png](./img/009/img_14.png)


#### @ResponseBody ì™€ @RestController

* `@ResponseBody` : ë©”ì†Œë“œë§ˆë‹¤ ë§¤ë²ˆ ë“±ë¡
* `@RestController`  : í´ë˜ìŠ¤ëª…ì— í•œë²ˆë§Œ ë“±ë¡

```java
@RestController  //ì™¼ìª½ ì–´ë…¸í…Œì´ì…˜ì„ ì£¼ë©´ ë©”ì„œë“œë§ˆë‹¤ @ResponseBodyë¶™ì´ëŠ” ê²ƒì„ ìƒëµí•  ìˆ˜ ìˆë‹¤.
public class RestTestController {

    @GetMapping("/test/list1")
    public List<MemoDto2> list1() {

        List<MemoDto2> list = new ArrayList<>();
        list.add(new MemoDto2(1, "ê¹€ë‚˜ë‚˜", "1.jpg", "ì•ˆë…•í•˜ì„¸ìš”", 5, "2023-10-10"));
        list.add(new MemoDto2(1, "ìº”ë””ë°”", "2.jpg", "íˆíˆ", 2, "2023-10-13"));
        list.add(new MemoDto2(1, "ë¹„ë¹„ë¹…", "3.jpg", "íêµ¬", 7, "2023-11-22"));

        return list;
    }
}
```

### JSON í…ŒìŠ¤íŠ¸2 : POST ë°©ì‹ìœ¼ë¡œ JSON ë³´ë‚´ê¸°

```java
@PostMapping("/test/list2")
public Map<String, String> text(){
    Map<String, String> map = new HashMap<>();
    map.put("name","ì´ê²ƒì´");
    map.put("age","35");

    return map;
}
```

* í¬ìŠ¤íŠ¸ë§¨ì—ì„œ http://localhost:8080/test/list2 ë„£ê³  [Send]

![img_16.png](./img/009/img_16.png)


### ê¸°ë³¸ì„¸íŒ…

#### MemoDto

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class MemoDto {
    private int num;
    private String nickname;
    private String photo;
    private String memo;
    private int likes;
    private Timestamp writeday;
}
```

#### MemoRestController

```java
@PostMapping("/memo/upload")
public String fileUpload(@RequestParam("upload") MultipartFile upload, HttpServletRequest request){
    
    //íŒŒì¼ì„ ì—…ë¡œë“œí•  ìœ„ì¹˜
    System.out.println("ì—…ë¡œë“œí•œ íŒŒì¼ëª… " + upload.getOriginalFilename());
    String path = request.getSession().getServletContext().getRealPath("/resources/upload");
    System.out.println(path);

    //ëœë¤ íŒŒì¼ëª…
    String photo = UUID.randomUUID().toString();

    //ì—…ë¡œë“œ
    try {
        upload.transferTo(new File(path + "/" + photo));
    } catch (IllegalStateException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    }

    return photo;
}
```

#### list.jsp ìŠ¤í¬ë¦½íŠ¸ ì˜ì—­

```html
<h3 class="alert alert-success">ê°„ë‹¨í•œ ë©”ëª¨ë¥¼ ë‚¨ê²¨ë´…ì‹œë‹¤</h3>
<div class="memoform">
    <span class="camraupload">ğŸ“·</span>
    <input type="file" name="upload" id ="upload" style="display: none;">
    <br>
    <img src = "../res/upload/noimg.png" class = "photo">
</div>
<div class = "memolist">
    memo list
</div>
```

     
* processData : 
  * false : ì„œë²„ì— ì „ë‹¬í•˜ëŠ” ë°ì´í„°ëŠ” query string ì´ë¼ëŠ” í˜•íƒœë¡œ ì „ë‹¬ëœë‹¤. íŒŒì¼ì „ì†¡ì˜ ê²½ìš° ì´ë¥¼ í•˜ì§€ ì•Šì•„ì•¼í•˜ëŠ”ë° ê·¸ ì„¤ì •ì´ false.
* contentType : 
  * false : enctypeì´ ì›ë˜ ê¸°ë³¸ê°’ì€ application/x-www..(ìƒëµ) . multipart/form-dataë¡œ ë³€ê²½í•´ì¤€ë‹¤.
   

```jquery-css
$(function (){
    $(".camraupload").click(function (){
        $("#upload").trigger("click");
    });

    $("#upload").change(function (){
       let form = new FormData();
       form.append("upload", $("#upload")[0].files[0]);

       $.ajax({
           type:"post",
           dataType:"text",
           url:"./upload",
           processData : false,
           contentType : false,
           data: form,
           success:function (res){
                alert(res);
           },
           statusCode:{
               404:function (){
                   alert("json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”");
               },
               500:function (){
                   alert("ì„œë²„ì˜¤ë¥˜. ì½”ë“œë¥¼ ë‹¤ì‹œ í•œ ë²ˆ ë³´ì„¸ìš”.");
               }
           }
       }) ;
    });
});
```

